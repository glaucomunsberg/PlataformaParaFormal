(function(a){a.fn.maskMoney=function(b){b=a.extend({symbol:"US$",decimal:".",precision:2,thousands:",",allowZero:false,allowNegative:false,showSymbol:false,symbolStay:false,defaultZero:true},b);return this.each(function(){var j=a(this);function m(t){t=t||window.event;var o=t.charCode||t.keyCode||t.which;if(o==undefined){return false}if(o<48||o>57){if(o==45){j.val(e(j));return false}if(o==43){j.val(j.val().replace("-",""));return false}else{if(o==13){return true}else{i(t);return true}}}else{if(j.val().length==j.attr("maxlength")){return false}else{i(t);var r=String.fromCharCode(o);var n=j.get(0);var s=j.getInputSelection(n);var q=s.start;var p=s.end;n.value=n.value.substring(0,q)+r+n.value.substring(p,n.value.length);d(n,q+1);return false}}}function h(s){s=s||window.event;var o=s.charCode||s.keyCode||s.which;if(o==undefined){return false}var n=j.get(0);var r=j.getInputSelection(n);var q=r.start;var p=r.end;if(o==8){i(s);if(q==p){n.value=n.value.substring(0,q-1)+n.value.substring(p,n.value.length);q=q-1}else{n.value=n.value.substring(0,q)+n.value.substring(p,n.value.length)}d(n,q);return false}else{if(o==9){return true}else{if(o==46||o==63272){i(s);if(n.selectionStart==n.selectionEnd){n.value=n.value.substring(0,q)+n.value.substring(p+1,n.value.length)}else{n.value=n.value.substring(0,q)+n.value.substring(p,n.value.length)}d(n,q);return false}else{return true}}}}function k(o){if(j.val()==""&&b.defaultZero){j.val(c(l()))}else{j.val(c(j.val()))}if(this.createTextRange){var n=this.createTextRange();n.collapse(false);n.select()}}function f(n){if(a.browser.msie){m(n)}if(j.val()==c(l())){if(!b.allowZero){j.val("")}}else{if(!b.symbolStay){j.val(j.val().replace(b.symbol,""))}else{if(b.symbolStay&&j.val()==b.symbol){j.val("")}}}}function i(n){if(n.preventDefault){n.preventDefault()}else{n.returnValue=false}}function d(n,p){var o=j.val().length;j.val(g(n.value));var q=j.val().length;p=p-(o-q);j.setCursorPosition(p)}function g(z){z=z.replace(b.symbol,"");var o="0123456789";var w=z.length;var y="",A="",s="";if(w!=0&&z.charAt(0)=="-"){z=z.replace("-","");if(b.allowNegative){s="-"}}if(w==0){if(!b.defaultZero){return A}A="0.00"}for(var u=0;u<w;u++){if((z.charAt(u)!="0")&&(z.charAt(u)!=b.decimal)){break}}for(;u<w;u++){if(o.indexOf(z.charAt(u))!=-1){y+=z.charAt(u)}}var r=parseFloat(y);r=isNaN(r)?0:r/Math.pow(10,b.precision);A=r.toFixed(b.precision);u=b.precision==0?0:1;var q,x=(A=A.split("."))[u].substr(0,b.precision);for(q=(A=A[0]).length;(q-=3)>=1;){A=A.substr(0,q)+b.thousands+A.substr(q)}return(b.precision>0)?c(s+A+b.decimal+x+Array((b.precision+1)-x.length).join(0)):c(s+A)}function l(){var o=parseFloat("0")/Math.pow(10,b.precision);return(o.toFixed(b.precision)).replace(new RegExp("\\.","g"),b.decimal)}function c(n){if(b.showSymbol){if(n.substr(0,b.symbol.length)!=b.symbol){return b.symbol+n}}return n}function e(o){if(b.allowNegative){var n=o.val();if(o.val()!=""&&o.val().charAt(0)=="-"){return o.val().replace("-","")}else{return"-"+o.val()}}else{return o.val()}}j.bind("keypress",m);j.bind("keydown",h);j.bind("blur",f);j.bind("focus",k);j.one("unmaskMoney",function(){j.unbind("focus",k);j.unbind("blur",f);j.unbind("keydown",h);j.unbind("keypress",m);if(a.browser.msie){this.onpaste=null}else{if(a.browser.mozilla){this.removeEventListener("input",f,false)}}})})};a.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")};a.fn.setCursorPosition=function(b){this.each(function(d,e){if(e.setSelectionRange){e.focus();e.setSelectionRange(b,b)}else{if(e.createTextRange){var c=e.createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",b);c.select()}}});return this};a.fn.getInputSelection=function(f){var i=0,d=0,h,e,c,b,g;if(typeof f.selectionStart=="number"&&typeof f.selectionEnd=="number"){i=f.selectionStart;d=f.selectionEnd}else{e=document.selection.createRange();if(e&&e.parentElement()==f){b=f.value.length;h=f.value.replace(/\r\n/g,"\n");c=f.createTextRange();c.moveToBookmark(e.getBookmark());g=f.createTextRange();g.collapse(false);if(c.compareEndPoints("StartToEnd",g)>-1){i=d=b}else{i=-c.moveStart("character",-b);i+=h.slice(0,i).split("\n").length-1;if(c.compareEndPoints("EndToEnd",g)>-1){d=b}else{d=-c.moveEnd("character",-b);d+=h.slice(0,d).split("\n").length-1}}}}return{start:i,end:d}}})(jQuery);