<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100% } 
  body { height: 100%; margin: 0px; padding: 0px }
  #map_canvas { height: 100% }
</style>
<script type="text/javascript"
    src="https://maps.google.com/maps/api/js?sensor=false">
</script>
<script type="text/javascript"
    src="https://maps.gstatic.com/intl/pt-BR_ALL/mapfiles/417c/maps2.api/main.js" >
        
</script>

<script type="text/javascript">
    
var mostrarTrajetoria =false;
var rendererOptions = {
  draggable: true
};
var directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);;
var directionsService = new google.maps.DirectionsService();
var map;
var origem = new google.maps.LatLng(-31.771083, -52.325821);
var destino = new google.maps.LatLng(-31.771083, -52.325821);
var total = 0;
var caminhos = "";
function initialize() 
{
 
  var myOptions = {
    zoom: 15,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    center: origem
  };
  map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
  directionsDisplay.setMap(map);
  directionsDisplay.setPanel(document.getElementById("directionsPanel"));

  google.maps.event.addListener(directionsDisplay, 'directions_changed', function() {
    total_distancia(directionsDisplay.directions);
  });

  calcRoute();
}

function calcRoute() {
 
  var request = {
    origin: origem,
    destination: destino,
    travelMode: google.maps.TravelMode.WALKING
  };
  directionsService.route(request, function(response, status)
  {
    if (status == google.maps.DirectionsStatus.OK)
    {
      directionsDisplay.setDirections(response);
    }
  });
}

function total_distancia(result) {
  
  var myroute = result.routes[0];
  for (i = 0; i < myroute.legs.length; i++) {
    total += myroute.legs[i].distance.value;
    //alert("Inicio:" + myroute.legs[i].start_location);
    //alert("Final" + myroute.legs[i].end_location)
    //alert("Quantidade" + myroute.legs[i].steps.length)
    
    for(b = 0; b < myroute.legs[i].steps.length;b++ )
         caminhos += myroute.legs[i].steps[b].instructions+"<br>";     

    
    //alert("Espa√ßo" + myroute.legs[i].steps[b-1].start_location.toString() )
    
  }
  total = total / 1000;
  alert(total + " km");
  if(typeof (window.form_MapWithRoute_position) == 'function'){          
    form_MapWithRoute_position(inicio = new google.maps.LatLng(myroute.legs[0].start_location.lat(), myroute.legs[0].start_location.lng()), fiali = new google.maps.LatLng(myroute.legs[0].end_location.lat(),myroute.legs[0].end_location.lng()), total,caminhos );
  }
  
}

function form_MapWithRoute_position(latitude, longitude, total, caminhos ){
    alert( "Inicio e fim:" + latitude.toString() + " - " + longitude.toString() + " - " + total );
    alert( caminhos );
}


</script>
</head>
<body onload="initialize()">
    <div id="corpo_total_map" style="width:100%; height:100%; float:left">
        <div id="map_canvas" style="width:90%; height:100%; float:left"></div>
        <div id="directionsPanel" style="float: right; width: 9%; height:100%; direction: ltr; visibility: hidden "> </div>
    </div>
</body>
</html>
